<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />




  


  <link rel="alternate" href="/atom.xml" title="StriveZs的博客" type="application/atom+xml" />






<meta name="description" content="将x86汇编语言翻译成机器语言，而机器语言是写入到硬件板子上的。 具体以如下格式展示：（分号右边的是注释）  首先需要了解十五条基本指令，下面是指令的参考表  下面大致介绍一下每条指令的功能： 1、MOV是将源寄存器中的内容存放到目的寄存器中  2、ADD是将源寄存器 和目的寄存器中的内容相加存放到目的寄存器中  3、SUB是将目的寄存器中的内容和源寄存器中的内容相减存放到目的寄存器中  4、A">
<meta property="og:type" content="article">
<meta property="og:title" content="将汇编语言转换为机器语言">
<meta property="og:url" content="https://zs670980918.github.io/2018/07/26/jiang-hui-bian-yu-yan-zhuan-huan-wei-ji-qi-yu-yan/index.html">
<meta property="og:site_name" content="StriveZs的博客">
<meta property="og:description" content="将x86汇编语言翻译成机器语言，而机器语言是写入到硬件板子上的。 具体以如下格式展示：（分号右边的是注释）  首先需要了解十五条基本指令，下面是指令的参考表  下面大致介绍一下每条指令的功能： 1、MOV是将源寄存器中的内容存放到目的寄存器中  2、ADD是将源寄存器 和目的寄存器中的内容相加存放到目的寄存器中  3、SUB是将目的寄存器中的内容和源寄存器中的内容相减存放到目的寄存器中  4、A">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://47.100.4.8/wp-content/uploads/2018/07/QQ%E5%9B%BE%E7%89%8720180725093458.png">
<meta property="og:image" content="http://47.100.4.8/wp-content/uploads/2018/07/QQ%E5%9B%BE%E7%89%8720180726161957.png">
<meta property="og:image" content="http://47.100.4.8/wp-content/uploads/2018/07/QQ%E5%9B%BE%E7%89%8720180726162108.png">
<meta property="og:image" content="http://47.100.4.8/wp-content/uploads/2018/07/QQ%E5%9B%BE%E7%89%8720180726162700.png">
<meta property="og:image" content="http://47.100.4.8/wp-content/uploads/2018/07/QQ%E5%9B%BE%E7%89%8720180726162804.png">
<meta property="og:image" content="http://47.100.4.8/wp-content/uploads/2018/07/QQ%E5%9B%BE%E7%89%8720180726163246.png">
<meta property="og:image" content="http://47.100.4.8/wp-content/uploads/2018/07/QQ%E5%9B%BE%E7%89%8720180726163535.png">
<meta property="og:image" content="http://47.100.4.8/wp-content/uploads/2018/07/QQ%E5%9B%BE%E7%89%8720180726165040.png">
<meta property="og:image" content="http://47.100.4.8/wp-content/uploads/2018/07/QQ%E5%9B%BE%E7%89%8720180726162414.png">
<meta property="article:published_time" content="2018-07-26T09:10:00.000Z">
<meta property="article:modified_time" content="2018-07-26T09:10:00.000Z">
<meta property="article:author" content="StriveZs">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://47.100.4.8/wp-content/uploads/2018/07/QQ%E5%9B%BE%E7%89%8720180725093458.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'StriveZs'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://zs670980918.github.io/2018/07/26/jiang-hui-bian-yu-yan-zhuan-huan-wei-ji-qi-yu-yan/"/>





  <title>将汇编语言转换为机器语言 | StriveZs的博客</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?5c8bbf815dac51a855060f947b787303";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




<meta name="generator" content="Hexo 4.2.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">StriveZs的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-schedule">
          <a href="/schedule/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-calendar"></i> <br />
            
            Schedule
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            Sitemap
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://zs670980918.github.io/2018/07/26/jiang-hui-bian-yu-yan-zhuan-huan-wei-ji-qi-yu-yan/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="StriveZs">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.JPG">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="StriveZs的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">将汇编语言转换为机器语言</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-07-26T17:10:00+08:00">
                2018-07-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index">
                    <span itemprop="name">汇编语言</span>
                  </a>
                </span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80/%E7%A1%AC%E4%BB%B6%E7%B3%BB%E7%BB%9F/" itemprop="url" rel="index">
                    <span itemprop="name">硬件系统</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><img src="http://47.100.4.8/wp-content/uploads/2018/07/QQ%E5%9B%BE%E7%89%8720180725093458.png" alt=""> <strong>将x86汇编语言翻译成机器语言，而机器语言是写入到硬件板子上的。</strong> 具体以如下格式展示：（分号右边的是注释） <img src="http://47.100.4.8/wp-content/uploads/2018/07/QQ%E5%9B%BE%E7%89%8720180726161957.png" alt=""> <strong>首先需要了解十五条基本指令，下面是指令的参考表</strong> <img src="http://47.100.4.8/wp-content/uploads/2018/07/QQ%E5%9B%BE%E7%89%8720180726162108.png" alt=""> <strong>下面大致介绍一下每条指令的功能：</strong> 1、MOV是将源寄存器中的内容存放到目的寄存器中  2、ADD是将源寄存器 和目的寄存器中的内容相加存放到目的寄存器中  3、SUB是将目的寄存器中的内容和源寄存器中的内容相减存放到目的寄存器中  4、AND是将目的寄存器和源寄存器中的内容进行二进制按位与存放到目的寄存器中  5、OR是将目的寄存器和源寄存器中的内容进行二进制按位或存放到目的寄存器中  6、RR是将将RS中的内容向右循环位移一位，存档到RD中  7、INC是将RD寄存器中的内容自加一  8、 LAD是按照M的寻址方式通过地址D来访问内存，取出来的内容存放到RD中  9、STA是按照M的寻址方式将RD中的内容存放到内存D地址的位置 10、JMP是按照寻址方式M无条件跳转到D地址 11、BZC是当FC或FZ等于一时按照寻址方式M跳转到地址D对应的位置 12、IN是得到I/O端输入的内容存放到寄存器RD中 13、OUT是将寄存器RD中的内容输出到I/O端 14、LDI是将一个立即数放到RD寄存器中 15、HALT是停机指令 机器指令的注释部分就是按照助记符号来编写的。 至于$P 后面的内容下面我会介绍。 <strong>指令的格式分四种：</strong> （1）单字节指令格式（其中包括ADD、AND、INC、SUB、OR、RR、HLT和MOV） <img src="http://47.100.4.8/wp-content/uploads/2018/07/QQ%E5%9B%BE%E7%89%8720180726162700.png" alt=""> 其中RS为源寄存器，RD为目的寄存器 （2）IN和OUT的指令格式为： <img src="http://47.100.4.8/wp-content/uploads/2018/07/QQ%E5%9B%BE%E7%89%8720180726162804.png" alt=""> 其中P为I/O端口号，IN的一般为00H，OUT的一般为40H （3）LAD、STA、JMP和BZC指令格式如下： <img src="http://47.100.4.8/wp-content/uploads/2018/07/QQ%E5%9B%BE%E7%89%8720180726163246.png" alt=""> 其中M为寻址方式（四种），D为地址 （4）LDI指令格式如下： <img src="http://47.100.4.8/wp-content/uploads/2018/07/QQ%E5%9B%BE%E7%89%8720180726163535.png" alt=""> data为向寄存器中存放的数据 <strong>寻址方式参考表：</strong> <img src="http://47.100.4.8/wp-content/uploads/2018/07/QQ%E5%9B%BE%E7%89%8720180726165040.png" alt=""> <strong>以下是寄存器的参考表：</strong> <img src="http://47.100.4.8/wp-content/uploads/2018/07/QQ%E5%9B%BE%E7%89%8720180726162414.png" alt=""> 以MOV指令为例： 它以0100开头（至于为什么之后在微指令的设计方面我会说），后面的RS和RD分别为寄存器   假设是将R0寄存器的内容存放到R1中具体的编码形式应为： 0100 00 01 以STA指令为例： 设计将R1寄存器中的内容按照直接寻址存放到内存中4FH对应的位置 STA指令是以1101开头  直接寻址方式为00  指令格式为： 1101  00 01 （要转化为十六进制） 4F <strong>在了解了上面的内容后，就可以一点一点的将汇编语言转换为助记符指令，然后在转换机器码就可以了。</strong> <strong>这里分享一个小小的心得，为了保证程序能够快速运行进行少用访问的指令，要充分使用寄存器。</strong> <strong>还有就是循环loop的话可以使用jmp配合bzc来进行循环或者是条件跳转</strong> <strong>下面分享一个我写的奇数偶数个数判断的机器码：</strong></p>
<p>$P 00 20 ; START:IN RO,00H<br>$P 01 00 ;<br>$P 02 D0 ; STA 00 R0,6FH<br>$P 03 6F ;<br>$P 04 70 ; INC R0<br>$P 05 61 ; LDI 00,R1,01H<br>$P 06 01 ;<br>$P 07 22 ; LK:IN R2,00H<br>$P 08 00 ;<br>$P 09 16 ; AND R1,R2<br>$P 0A 99 ; JE R2,R1,JISHU<br>$P 0B 0E ;<br>$P 0C E0 ; JMP XUNHUAN<br>$P 0D 0F ;<br>$P 0E 73 ; JISHU:INC R3<br>$P 0F 84 ; XUNHUAN:SUB R1,R0<br>$P 10 94 ; JE R1,R0,EXIT<br>$P 11 14 ;<br>$P 12 E0 ; JMP LK<br>$P 13 07 ;<br>$P 14 C0 ; EXIT:LAD 00 ,R0,6FH<br>$P 15 6F ;<br>$P 16 8C ; SUB R3,R0<br>$P 17 3C ; OUT R0,40H<br>$P 18 40 ;<br>$P 19 30 ; OUT R3,40H<br>$P 1A 40 ;<br>$P 1B 50 ; HLT</p>
<p>至于微指令的编写，我会在以后的博文里面讲解。 偷偷分享一下自己写的汇编指令</p>
<p>data segment<br>    input db ‘please input a lot of number:’,’$’<br>    output1 db ‘The number of odd numbers is:’,’$’<br>    output2 db ‘The number of even numbers is:’,’$’<br>data ends</p>
<p>code segment<br>    assume cs:code,ds:data<br>    start:<br>    mov ax,data<br>    mov ds,ax</p>
<pre><code>mov ah,01H  ;输入要输入数据的个数
int 21H
sub al,30H

mov cx,0H
mov cl,al

mov dl,0AH
mov ah,02H
int 21H

mov bp,0 ;偶数计数器
mov si,0 ;奇数计数器</code></pre><p>lk:<br>    mov ah,01H<br>    int 21H<br>    sub al,30H<br>    and al,01H<br>    cmp al,01H<br>    jz jishu<br>    inc bp<br>    jmp useloop<br>jishu:<br>    inc si<br>    jmp useloop</p>
<p>useloop:<br>    loop lk</p>
<p>end1:<br>    mov dl,0AH<br>    mov ah,02H<br>    int 21H</p>
<pre><code>mov ax,0H
mov ax,bp
add ax,30H

mov bx,0H
mov bx,si
add bx,30H

mov dl,0H
mov dl,al
mov ah,02H
int 21H

mov dl,0H
mov dl,bl
mov ah,02H
int 21H

mov ah,4ch
int 21H</code></pre><p>code ends<br>end start</p>

      
    </div>
    
    
    

    
      <div>
        <div id="wechat_subscriber" style="display: block; padding: 10px 0; margin: 20px auto; width: 100%; text-align: center">
    <img id="wechat_subscriber_qcode" src="/path/to/your/wechatqcode ex. /uploads/wechat-qcode.jpg" alt="StriveZs wechat" style="width: 200px; max-width: 100%;"/>
    <div>Where is will, there is a way.</div>
</div>

      </div>
    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/07/26/jiang-hui-bian-yu-yan-zhuan-huan-wei-ji-qi-yu-yan-1/" rel="next" title="将汇编语言转换为机器语言">
                <i class="fa fa-chevron-left"></i> 将汇编语言转换为机器语言
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/07/27/ji-yu-yi-chuan-suan-fa-de-bp-shen-jing-wang-luo-you-hua-suan-fa-1/" rel="prev" title="基于遗传算法的BP神经网络优化算法">
                基于遗传算法的BP神经网络优化算法 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.JPG"
                alt="StriveZs" />
            
              <p class="site-author-name" itemprop="name">StriveZs</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%7C%7C%20archive">
              
                  <span class="site-state-item-count">503</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">162</span>
                  <span class="site-state-item-name">categories</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">tags</span>
                
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">StriveZs</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>



        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
